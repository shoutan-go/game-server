{"version":3,"sources":["/Users/lookis/Projects/game-server/webpack/bootstrap b6e0012e917940485823","/Users/lookis/Projects/game-server/external \"graphql\"","/Users/lookis/Projects/game-server/src/config.js","/Users/lookis/Projects/game-server/src/redis.js","/Users/lookis/Projects/game-server/src/data/sequelize.js","/Users/lookis/Projects/game-server/external \"sequelize\"","/Users/lookis/Projects/game-server/external \"react\"","/Users/lookis/Projects/game-server/external \"node-fetch\"","/Users/lookis/Projects/game-server/src/data/models/index.js","/Users/lookis/Projects/game-server/external \"prop-types\"","/Users/lookis/Projects/game-server/src/data/types/GoType.js","/Users/lookis/Projects/game-server/external \"react-apollo\"","/Users/lookis/Projects/game-server/external \"bluebird\"","/Users/lookis/Projects/game-server/external \"express\"","/Users/lookis/Projects/game-server/src/routes/error/ErrorPage.css","/Users/lookis/Projects/game-server/external \"querystring\"","/Users/lookis/Projects/game-server/external \"redux\"","/Users/lookis/Projects/game-server/src/constants/index.js","/Users/lookis/Projects/game-server/node_modules/css-loader/lib/css-base.js","/Users/lookis/Projects/game-server/node_modules/isomorphic-style-loader/lib/insertCss.js","/Users/lookis/Projects/game-server/external \"isomorphic-style-loader/lib/withStyles\"","/Users/lookis/Projects/game-server/external \"game-engine\"","/Users/lookis/Projects/game-server/external \"@babel/polyfill\"","/Users/lookis/Projects/game-server/src/server.js","/Users/lookis/Projects/game-server/external \"path\"","/Users/lookis/Projects/game-server/external \"express-session\"","/Users/lookis/Projects/game-server/external \"connect-redis\"","/Users/lookis/Projects/game-server/external \"express-ws\"","/Users/lookis/Projects/game-server/external \"cookie-parser\"","/Users/lookis/Projects/game-server/external \"body-parser\"","/Users/lookis/Projects/game-server/external \"express-jwt\"","/Users/lookis/Projects/game-server/external \"express-graphql\"","/Users/lookis/Projects/game-server/external \"jsonwebtoken\"","/Users/lookis/Projects/game-server/external \"react-dom/server\"","/Users/lookis/Projects/game-server/external \"pretty-error\"","/Users/lookis/Projects/game-server/external \"material-ui/styles/MuiThemeProvider\"","/Users/lookis/Projects/game-server/external \"material-ui/styles/getMuiTheme\"","/Users/lookis/Projects/game-server/src/core/createApolloClient/createApolloClient.server.js","/Users/lookis/Projects/game-server/external \"apollo-client\"","/Users/lookis/Projects/game-server/external \"apollo-link\"","/Users/lookis/Projects/game-server/external \"apollo-link-error\"","/Users/lookis/Projects/game-server/external \"apollo-link-schema\"","/Users/lookis/Projects/game-server/src/core/createApolloClient/createCache.js","/Users/lookis/Projects/game-server/external \"apollo-cache-inmemory\"","/Users/lookis/Projects/game-server/src/components/App.js","/Users/lookis/Projects/game-server/external \"react-redux\"","/Users/lookis/Projects/game-server/src/components/Html.js","/Users/lookis/Projects/game-server/external \"serialize-javascript\"","/Users/lookis/Projects/game-server/src/routes/error/ErrorPage.js","webpack:///./src/routes/error/ErrorPage.css?f0d0","/Users/lookis/Projects/game-server/external \"babel-runtime/core-js/json/stringify\"","/Users/lookis/Projects/game-server/external \"babel-runtime/helpers/slicedToArray\"","/Users/lookis/Projects/game-server/src/createFetch.js","/Users/lookis/Projects/game-server/src/connection.js","/Users/lookis/Projects/game-server/src/data/models/User.js","/Users/lookis/Projects/game-server/src/data/models/UserLogin.js","/Users/lookis/Projects/game-server/src/data/models/UserClaim.js","/Users/lookis/Projects/game-server/src/data/models/UserProfile.js","/Users/lookis/Projects/game-server/external \"redis\"","/Users/lookis/Projects/game-server/src/passport.js","/Users/lookis/Projects/game-server/external \"passport\"","/Users/lookis/Projects/game-server/external \"passport-wechat\"","/Users/lookis/Projects/game-server/src/router.js","/Users/lookis/Projects/game-server/external \"universal-router\"","/Users/lookis/Projects/game-server/src/routes/index.js","/Users/lookis/Projects/game-server/src/data/schema.js","/Users/lookis/Projects/game-server/src/data/queries/me.js","/Users/lookis/Projects/game-server/src/data/types/UserType.js","/Users/lookis/Projects/game-server/src/data/queries/news.js","/Users/lookis/Projects/game-server/src/data/types/NewsItemType.js","/Users/lookis/Projects/game-server/src/data/queries/go.js","/Users/lookis/Projects/game-server/src/data/queries/wechat.js","/Users/lookis/Projects/game-server/external \"crypto\"","/Users/lookis/Projects/game-server/src/data/types/WechatType.js","/Users/lookis/Projects/game-server/src/data/mutations/create.js","/Users/lookis/Projects/game-server/src/data/mutations/update.js","/Users/lookis/Projects/game-server/external \"./assets.json\"","/Users/lookis/Projects/game-server/src/store/configureStore.js","/Users/lookis/Projects/game-server/src/reducers/index.js","/Users/lookis/Projects/game-server/src/reducers/user.js","/Users/lookis/Projects/game-server/src/reducers/runtime.js","/Users/lookis/Projects/game-server/src/store/logger/logger.server.js","/Users/lookis/Projects/game-server/external \"util\"","/Users/lookis/Projects/game-server/src/actions/runtime.js","/Users/lookis/Projects/game-server/external \"classnames/bind\"","/Users/lookis/Projects/game-server/external \"material-ui/SelectField\"","/Users/lookis/Projects/game-server/external \"material-ui/MenuItem\"","/Users/lookis/Projects/game-server/external \"material-ui/RaisedButton\"","/Users/lookis/Projects/game-server/external \"sweetalert2\"","/Users/lookis/Projects/game-server/external \"react-websocket\"","/Users/lookis/Projects/game-server/external \"react-rangeslider\""],"names":["Error","module","exports","port","process","env","PORT","api","clientUrl","API_CLIENT_URL","serverUrl","API_SERVER_URL","databaseUrl","DATABASE_URL","auth","jwt","secret","JWT_SECRET","gnugo","GNUGO","redis","REDIS","sessionSecret","SESSION_SECRET","wechat","appId","appSecret","bluebird","promisifyAll","RedisClient","prototype","Multi","client","createClient","config","subscriber","on","console","log","err","sequelize","define","freezeTableName","User","hasMany","foreignKey","as","onUpdate","onDelete","hasOne","sync","GoType","name","fields","id","type","engine","info","boardsize","black","GraphQLString","white","SET_RUNTIME_VARIABLE","app","express","expressWs","global","navigator","userAgent","use","static","path","resolve","__dirname","cookieParser","bodyParser","urlencoded","extended","json","expressJwt","credentialsRequired","getToken","req","cookies","id_token","res","next","error","clearCookie","passport","initialize","enable","get","set","RedisStore","connectRedis","session","store","resave","saveUninitialized","authenticate","failureRedirect","expiresIn","token","sign","user","cookie","maxAge","httpOnly","redirect","graphqlMiddleware","expressGraphQL","schema","graphiql","rootValue","request","pretty","__DEV__","connection","css","Set","apolloClient","createApolloClient","fetch","createFetch","baseUrl","headers","initialState","configureStore","history","dispatch","setRuntimeVariable","value","Date","now","context","insertCss","styles","forEach","add","style","_getCss","storeSubscription","router","pathname","query","route","from","status","data","rootComponent","getMuiTheme","component","getDataFromTree","Promise","delay","ReactDOM","renderToString","children","cssText","join","scripts","assets","vendor","js","push","chunks","map","chunk","apiUrl","state","getState","apolloState","extract","hostname","html","renderToStaticMarkup","send","pe","skipNodeFiles","skipPackage","render","message","errorPageStyle","promise","models","catch","stack","then","listen","hot","accept","link","onError","graphQLErrors","networkError","locations","warn","cache","createCache","ssrMode","queryDeduplication","dataIdFromObject","obj","__typename","defaultDataIdFromObject","ContextType","PropTypes","func","isRequired","ReduxProvider","childContextTypes","object","App","props","React","PureComponent","Html","asset","startsWith","domain","split","length","title","description","assetsMap","script","__html","serialize","analytics","googleTrackingId","Component","ErrorPage","withStyles","defaults","method","mode","credentials","Accept","Cookie","url","options","re","RegExp","channels","channel","chan","ws","Router","msg","JSON","parse","all","getAsync","hgetallAsync","lrangeAsync","rule","moves","GameEngine","result","color","position","rpushAsync","stringify","publishAsync","code","move","currentColor","Go","COLOR","BLACK","WHITE","body","toSgf","text","r","match","hsetAsync","splice","indexOf","unsubscribe","params","subscribe","findAll","where","$in","include","attributes","model","required","players","users","filter","e","u","plain","displayName","profile","picture","player","Object","assign","game","avatar","Model","DataType","UUID","defaultValue","UUIDV1","primaryKey","email","STRING","validate","isEmail","emailConfirmed","BOOLEAN","indexes","UserLogin","key","UserClaim","UserProfile","userId","gender","location","website","appID","callbackURL","scope","passReqToCallback","accessToken","refreshToken","expiredIn","done","loginName","claimType","unionid","openid","fooBar","findOne","userLogin","create","logins","claims","nickname","sex","headimgurl","resolveRoute","protected","querystring","load","action","default","undefined","routes","unshift","require","me","go","news","mutation","createGo","updateGo","update","UserType","StringType","items","lastFetchTask","lastFetchTime","response","NewsItemType","author","pubDate","content","args","root","payload","algo","crypto","createHash","ordered","keys","sort","stringA","unescape","digest","ticket","errcode","setexAsync","expires_in","access_token","noncestr","Math","random","toString","timestamp","floor","getTime","signature","jsapi_ticket","nonceStr","errmsg","WechatType","GraphQLInt","handicap","komi","GraphQLFloat","setAsync","hmsetAsync","hmgetAsync","middleware","enhancer","createLogger","devToolsExtension","f","BROWSER","window","compose","applyMiddleware","rootReducer","createRootReducer","createStore","replaceReducer","combineReducers","runtime","inspectObject","inspect","colors","singleLine","str","replace","actionFormatters","APOLLO_QUERY_INIT","a","queryId","variables","queryString","APOLLO_QUERY_RESULT","APOLLO_QUERY_STOP","formattedPayload","actionFormatter"],"mappings":"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,uCAAuC,gBAAgB;;AAE7F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,0DAA0D,EAAE;AAC5D;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA,2CAA2C,YAAY,EAAE;AACzD;AACA;AACA;AACA;AACA;AACA,mFAAmF;AACnF;AACA;AACA;AACA;;AAEA;AACA,iBAAiB,mBAAmB;AACpC;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,+DAA+D;AAC/D;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;;AAEA,2B;;;;;;AC3HA,mE;;;;;;ACAA,wC;;;;;;;;;;;;;;ACAA,4C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAA;;;;;;;;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;CACoC;;AACpC;AACA;AACA;AAEA,IAAMC,MAAM,+CAAAC,EAAZ;AACA,kDAAAC,CAAUF,GAAV,E,CACA;AACA;AACA;AACA;;AACAG,OAAOC,SAAP,GAAmBD,OAAOC,SAAP,IAAoB,EAAvC;AACAD,OAAOC,SAAP,CAAiBC,SAAjB,GAA6BF,OAAOC,SAAP,CAAiBC,SAAjB,IAA8B,KAA3D,C,CAEA;AACA;AACA;;AACAL,IAAIM,GAAJ,CAAQ,+CAAAL,CAAQM,MAAR,CAAe,4CAAAC,CAAKC,OAAL,CAAaC,SAAb,EAAwB,QAAxB,CAAf,CA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","file":"server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded chunks\n \t// \"0\" means \"already loaded\"\n \tvar installedChunks = {\n \t\t7: 0\n \t};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n \t// This file contains only the entry chunk.\n \t// The chunk loading function for additional chunks\n \t__webpack_require__.e = function requireEnsure(chunkId) {\n \t\t// \"0\" is the signal for \"already loaded\"\n \t\tif(installedChunks[chunkId] !== 0) {\n \t\t\tvar chunk = require(\"./chunks/\" + ({\"0\":\"go\",\"1\":\"home\",\"2\":\"go-creation\",\"3\":\"about\",\"4\":\"not-found\",\"5\":\"login\",\"6\":\"admin\"}[chunkId]||chunkId) + \".js\");\n \t\t\tvar moreModules = chunk.modules, chunkIds = chunk.ids;\n \t\t\tfor(var moduleId in moreModules) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t\tfor(var i = 0; i < chunkIds.length; i++)\n \t\t\t\tinstalledChunks[chunkIds[i]] = 0;\n \t\t}\n \t\treturn Promise.resolve();\n \t};\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/assets/\";\n\n \t// uncatched error handler for webpack runtime\n \t__webpack_require__.oe = function(err) {\n \t\tprocess.nextTick(function() {\n \t\t\tthrow err; // catch this error by using System.import().catch()\n \t\t});\n \t};\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 21);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap b6e0012e917940485823","module.exports = require(\"graphql\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"graphql\"\n// module id = 0\n// module chunks = 7","/**\n * React Starter Kit (https://www.reactstarterkit.com/)\n *\n * Copyright © 2014-present Kriasoft, LLC. All rights reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\n/* eslint-disable max-len */\n\nif (process.env.BROWSER) {\n  throw new Error(\n    'Do not import `config.js` from inside the client-side code.',\n  );\n}\n\nmodule.exports = {\n  // Node.js app\n  port: process.env.PORT || 3000,\n\n  // API Gateway\n  api: {\n    // API URL to be used in the client-side code\n    clientUrl: process.env.API_CLIENT_URL || '',\n    // API URL to be used in the server-side code\n    serverUrl:\n      process.env.API_SERVER_URL ||\n      `http://localhost:${process.env.PORT || 3000}`,\n  },\n\n  // Database\n  databaseUrl: process.env.DATABASE_URL || 'sqlite:database.sqlite',\n\n  // Authentication\n  auth: {\n    jwt: { secret: process.env.JWT_SECRET || 'React Starter Kit!' },\n  },\n  // GNUGO\n  gnugo: process.env.GNUGO || 'http://127.0.0.1:5001/score/estimate',\n\n  // Redis\n  redis: process.env.REDIS || 'redis://localhost:6379',\n\n  sessionSecret: process.env.SESSION_SECRET || \"It's a secret\",\n\n  wechat: {\n    appId: 'wxc67a197c5c3f004e',\n    appSecret: '60e541fff59447a7267502f974cc262d',\n  },\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/config.js","import bluebird from 'bluebird';\nimport redis from 'redis';\n\nimport config from './config';\n\nbluebird.promisifyAll(redis.RedisClient.prototype);\nbluebird.promisifyAll(redis.Multi.prototype);\n\nconst client = redis.createClient(config.redis);\nconst subscriber = redis.createClient(config.redis);\n\nclient.on('error', err => console.log(err)); // eslint-disable-line no-console\nsubscriber.on('error', err => console.log(err)); // eslint-disable-line no-console\n\nexport { client as redis, subscriber };\n\n\n\n// WEBPACK FOOTER //\n// ./src/redis.js","/**\n * React Starter Kit (https://www.reactstarterkit.com/)\n *\n * Copyright © 2014-present Kriasoft, LLC. All rights reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nimport Sequelize from 'sequelize';\nimport config from '../config';\n\nconst sequelize = new Sequelize(config.databaseUrl, {\n  define: {\n    freezeTableName: true,\n  },\n});\n\nexport default sequelize;\n\n\n\n// WEBPACK FOOTER //\n// ./src/data/sequelize.js","module.exports = require(\"sequelize\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"sequelize\"\n// module id = 4\n// module chunks = 7","module.exports = require(\"react\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react\"\n// module id = 5\n// module chunks = 7","module.exports = require(\"node-fetch\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-fetch\"\n// module id = 6\n// module chunks = 7","/**\n * React Starter Kit (https://www.reactstarterkit.com/)\n *\n * Copyright © 2014-present Kriasoft, LLC. All rights reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nimport sequelize from '../sequelize';\nimport User from './User';\nimport UserLogin from './UserLogin';\nimport UserClaim from './UserClaim';\nimport UserProfile from './UserProfile';\n\nUser.hasMany(UserLogin, {\n  foreignKey: 'userId',\n  as: 'logins',\n  onUpdate: 'cascade',\n  onDelete: 'cascade',\n});\n\nUser.hasMany(UserClaim, {\n  foreignKey: 'userId',\n  as: 'claims',\n  onUpdate: 'cascade',\n  onDelete: 'cascade',\n});\n\nUser.hasOne(UserProfile, {\n  foreignKey: 'userId',\n  as: 'profile',\n  onUpdate: 'cascade',\n  onDelete: 'cascade',\n});\n\nfunction sync(...args) {\n  return sequelize.sync(...args);\n}\n\nexport default { sync };\nexport { User, UserLogin, UserClaim, UserProfile };\n\n\n\n// WEBPACK FOOTER //\n// ./src/data/models/index.js","module.exports = require(\"prop-types\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"prop-types\"\n// module id = 8\n// module chunks = 7","import {\n  GraphQLInt,\n  GraphQLNonNull,\n  GraphQLObjectType,\n  GraphQLString,\n} from 'graphql';\n\nconst GoType = new GraphQLObjectType({\n  name: 'Go',\n  fields: {\n    id: {\n      type: new GraphQLNonNull(GraphQLString),\n    },\n    engine: {\n      type: new GraphQLNonNull(GraphQLString),\n    },\n    info: {\n      type: new GraphQLObjectType({\n        name: 'GoInfo',\n        fields: {\n          boardsize: {\n            type: new GraphQLNonNull(GraphQLInt),\n          },\n          black: {\n            type: GraphQLString,\n          },\n          white: {\n            type: GraphQLString,\n          },\n        },\n      }),\n    },\n  },\n});\n\nexport default GoType;\n\n\n\n// WEBPACK FOOTER //\n// ./src/data/types/GoType.js","module.exports = require(\"react-apollo\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-apollo\"\n// module id = 10\n// module chunks = 7","module.exports = require(\"bluebird\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bluebird\"\n// module id = 11\n// module chunks = 7","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 12\n// module chunks = 7","\n    var content = require(\"!!../../../node_modules/css-loader/index.js??ref--2-rules-2!../../../node_modules/postcss-loader/lib/index.js??ref--2-rules-3!./ErrorPage.css\");\n    var insertCss = require(\"!../../../node_modules/isomorphic-style-loader/lib/insertCss.js\");\n\n    if (typeof content === 'string') {\n      content = [[module.id, content, '']];\n    }\n\n    module.exports = content.locals || {};\n    module.exports._getContent = function() { return content; };\n    module.exports._getCss = function() { return content.toString(); };\n    module.exports._insertCss = function(options) { return insertCss(content, options) };\n    \n    // Hot Module Replacement\n    // https://webpack.github.io/docs/hot-module-replacement\n    // Only activated in browser context\n    if (module.hot && typeof window !== 'undefined' && window.document) {\n      var removeCss = function() {};\n      module.hot.accept(\"!!../../../node_modules/css-loader/index.js??ref--2-rules-2!../../../node_modules/postcss-loader/lib/index.js??ref--2-rules-3!./ErrorPage.css\", function() {\n        content = require(\"!!../../../node_modules/css-loader/index.js??ref--2-rules-2!../../../node_modules/postcss-loader/lib/index.js??ref--2-rules-3!./ErrorPage.css\");\n\n        if (typeof content === 'string') {\n          content = [[module.id, content, '']];\n        }\n\n        removeCss = insertCss(content, { replace: true });\n      });\n      module.hot.dispose(function() { removeCss(); });\n    }\n  \n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/routes/error/ErrorPage.css\n// module id = 13\n// module chunks = 7","module.exports = require(\"querystring\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"querystring\"\n// module id = 14\n// module chunks = 7","module.exports = require(\"redux\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"redux\"\n// module id = 15\n// module chunks = 7","/* eslint-disable import/prefer-default-export */\n\nexport const SET_RUNTIME_VARIABLE = 'SET_RUNTIME_VARIABLE';\n\n\n\n// WEBPACK FOOTER //\n// ./src/constants/index.js","/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n// css base code, injected by the css-loader\nmodule.exports = function(useSourceMap) {\n\tvar list = [];\n\n\t// return the list of modules as css string\n\tlist.toString = function toString() {\n\t\treturn this.map(function (item) {\n\t\t\tvar content = cssWithMappingToString(item, useSourceMap);\n\t\t\tif(item[2]) {\n\t\t\t\treturn \"@media \" + item[2] + \"{\" + content + \"}\";\n\t\t\t} else {\n\t\t\t\treturn content;\n\t\t\t}\n\t\t}).join(\"\");\n\t};\n\n\t// import a list of modules into the list\n\tlist.i = function(modules, mediaQuery) {\n\t\tif(typeof modules === \"string\")\n\t\t\tmodules = [[null, modules, \"\"]];\n\t\tvar alreadyImportedModules = {};\n\t\tfor(var i = 0; i < this.length; i++) {\n\t\t\tvar id = this[i][0];\n\t\t\tif(typeof id === \"number\")\n\t\t\t\talreadyImportedModules[id] = true;\n\t\t}\n\t\tfor(i = 0; i < modules.length; i++) {\n\t\t\tvar item = modules[i];\n\t\t\t// skip already imported module\n\t\t\t// this implementation is not 100% perfect for weird media query combinations\n\t\t\t//  when a module is imported multiple times with different media queries.\n\t\t\t//  I hope this will never occur (Hey this way we have smaller bundles)\n\t\t\tif(typeof item[0] !== \"number\" || !alreadyImportedModules[item[0]]) {\n\t\t\t\tif(mediaQuery && !item[2]) {\n\t\t\t\t\titem[2] = mediaQuery;\n\t\t\t\t} else if(mediaQuery) {\n\t\t\t\t\titem[2] = \"(\" + item[2] + \") and (\" + mediaQuery + \")\";\n\t\t\t\t}\n\t\t\t\tlist.push(item);\n\t\t\t}\n\t\t}\n\t};\n\treturn list;\n};\n\nfunction cssWithMappingToString(item, useSourceMap) {\n\tvar content = item[1] || '';\n\tvar cssMapping = item[3];\n\tif (!cssMapping) {\n\t\treturn content;\n\t}\n\n\tif (useSourceMap && typeof btoa === 'function') {\n\t\tvar sourceMapping = toComment(cssMapping);\n\t\tvar sourceURLs = cssMapping.sources.map(function (source) {\n\t\t\treturn '/*# sourceURL=' + cssMapping.sourceRoot + source + ' */'\n\t\t});\n\n\t\treturn [content].concat(sourceURLs).concat([sourceMapping]).join('\\n');\n\t}\n\n\treturn [content].join('\\n');\n}\n\n// Adapted from convert-source-map (MIT)\nfunction toComment(sourceMap) {\n\t// eslint-disable-next-line no-undef\n\tvar base64 = btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));\n\tvar data = 'sourceMappingURL=data:application/json;charset=utf-8;base64,' + base64;\n\n\treturn '/*# ' + data + ' */';\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/css-loader/lib/css-base.js\n// module id = 17\n// module chunks = 7","'use strict';\n\nvar _stringify = require('babel-runtime/core-js/json/stringify');\n\nvar _stringify2 = _interopRequireDefault(_stringify);\n\nvar _slicedToArray2 = require('babel-runtime/helpers/slicedToArray');\n\nvar _slicedToArray3 = _interopRequireDefault(_slicedToArray2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Isomorphic CSS style loader for Webpack\n *\n * Copyright © 2015-present Kriasoft, LLC. All rights reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nvar prefix = 's';\nvar inserted = {};\n\n// Base64 encoding and decoding - The \"Unicode Problem\"\n// https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding#The_Unicode_Problem\nfunction b64EncodeUnicode(str) {\n  return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, function (match, p1) {\n    return String.fromCharCode('0x' + p1);\n  }));\n}\n\n/**\n * Remove style/link elements for specified node IDs\n * if they are no longer referenced by UI components.\n */\nfunction removeCss(ids) {\n  ids.forEach(function (id) {\n    if (--inserted[id] <= 0) {\n      var elem = document.getElementById(prefix + id);\n      if (elem) {\n        elem.parentNode.removeChild(elem);\n      }\n    }\n  });\n}\n\n/**\n * Example:\n *   // Insert CSS styles object generated by `css-loader` into DOM\n *   var removeCss = insertCss([[1, 'body { color: red; }']]);\n *\n *   // Remove it from the DOM\n *   removeCss();\n */\nfunction insertCss(styles) {\n  var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n      _ref$replace = _ref.replace,\n      replace = _ref$replace === undefined ? false : _ref$replace,\n      _ref$prepend = _ref.prepend,\n      prepend = _ref$prepend === undefined ? false : _ref$prepend;\n\n  var ids = [];\n  for (var i = 0; i < styles.length; i++) {\n    var _styles$i = (0, _slicedToArray3.default)(styles[i], 4),\n        moduleId = _styles$i[0],\n        css = _styles$i[1],\n        media = _styles$i[2],\n        sourceMap = _styles$i[3];\n\n    var id = moduleId + '-' + i;\n\n    ids.push(id);\n\n    if (inserted[id]) {\n      if (!replace) {\n        inserted[id]++;\n        continue;\n      }\n    }\n\n    inserted[id] = 1;\n\n    var elem = document.getElementById(prefix + id);\n    var create = false;\n\n    if (!elem) {\n      create = true;\n\n      elem = document.createElement('style');\n      elem.setAttribute('type', 'text/css');\n      elem.id = prefix + id;\n\n      if (media) {\n        elem.setAttribute('media', media);\n      }\n    }\n\n    var cssText = css;\n    if (sourceMap && typeof btoa === 'function') {\n      // skip IE9 and below, see http://caniuse.com/atob-btoa\n      cssText += '\\n/*# sourceMappingURL=data:application/json;base64,' + b64EncodeUnicode((0, _stringify2.default)(sourceMap)) + '*/';\n      cssText += '\\n/*# sourceURL=' + sourceMap.file + '?' + id + '*/';\n    }\n\n    if ('textContent' in elem) {\n      elem.textContent = cssText;\n    } else {\n      elem.styleSheet.cssText = cssText;\n    }\n\n    if (create) {\n      if (prepend) {\n        document.head.insertBefore(elem, document.head.childNodes[0]);\n      } else {\n        document.head.appendChild(elem);\n      }\n    }\n  }\n\n  return removeCss.bind(null, ids);\n}\n\nmodule.exports = insertCss;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/isomorphic-style-loader/lib/insertCss.js\n// module id = 18\n// module chunks = 7","module.exports = require(\"isomorphic-style-loader/lib/withStyles\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"isomorphic-style-loader/lib/withStyles\"\n// module id = 19\n// module chunks = 7","module.exports = require(\"game-engine\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"game-engine\"\n// module id = 20\n// module chunks = 7","module.exports = require(\"@babel/polyfill\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"@babel/polyfill\"\n// module id = 22\n// module chunks = 7","/**\n * React Starter Kit (https://www.reactstarterkit.com/)\n *\n * Copyright © 2014-present Kriasoft, LLC. All rights reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nimport path from 'path';\nimport Promise from 'bluebird';\nimport express from 'express';\nimport session from 'express-session';\nimport connectRedis from 'connect-redis';\nimport expressWs from 'express-ws';\nimport cookieParser from 'cookie-parser';\nimport bodyParser from 'body-parser';\nimport expressJwt, { UnauthorizedError as Jwt401Error } from 'express-jwt';\nimport expressGraphQL from 'express-graphql';\nimport jwt from 'jsonwebtoken';\nimport nodeFetch from 'node-fetch';\nimport React from 'react';\nimport ReactDOM from 'react-dom/server';\nimport { getDataFromTree } from 'react-apollo';\nimport PrettyError from 'pretty-error';\nimport MuiThemeProvider from 'material-ui/styles/MuiThemeProvider';\nimport getMuiTheme from 'material-ui/styles/getMuiTheme';\nimport createApolloClient from './core/createApolloClient';\nimport App from './components/App';\nimport Html from './components/Html';\nimport { ErrorPageWithoutStyle } from './routes/error/ErrorPage';\nimport errorPageStyle from './routes/error/ErrorPage.css';\nimport createFetch from './createFetch';\nimport connection from './connection';\nimport passport from './passport';\nimport router from './router';\nimport { redis } from './redis';\nimport models from './data/models';\nimport schema from './data/schema';\nimport assets from './assets.json'; // eslint-disable-line import/no-unresolved\nimport configureStore from './store/configureStore';\nimport { setRuntimeVariable } from './actions/runtime';\nimport config from './config';\n\nconst app = express();\nexpressWs(app);\n//\n// Tell any CSS tooling (such as Material UI) to use all vendor prefixes if the\n// user agent is not known.\n// -----------------------------------------------------------------------------\nglobal.navigator = global.navigator || {};\nglobal.navigator.userAgent = global.navigator.userAgent || 'all';\n\n//\n// Register Node.js middleware\n// -----------------------------------------------------------------------------\napp.use(express.static(path.resolve(__dirname, 'public')));\napp.use(cookieParser());\napp.use(bodyParser.urlencoded({ extended: true }));\napp.use(bodyParser.json());\n//\n// Authentication\n// -----------------------------------------------------------------------------\napp.use(\n  expressJwt({\n    secret: config.auth.jwt.secret,\n    credentialsRequired: false,\n    getToken: req => req.cookies.id_token,\n  }),\n);\n// Error handler for express-jwt\napp.use((err, req, res, next) => {\n  // eslint-disable-line no-unused-vars\n  if (err instanceof Jwt401Error) {\n    console.error('[express-jwt-error]', req.cookies.id_token);\n    // `clearCookie`, otherwise user can't use web-app until cookie expires\n    res.clearCookie('id_token');\n  }\n  next(err);\n});\n\napp.use(passport.initialize());\n\nif (__DEV__) {\n  app.enable('trust proxy');\n}\nif (app.get('env') === 'production') {\n  app.set('trust proxy', 1); // trust first proxy\n}\nconst RedisStore = connectRedis(session);\napp.use(\n  session({\n    store: new RedisStore({\n      client: redis,\n    }),\n    secret: config.sessionSecret,\n    resave: false,\n    saveUninitialized: true,\n  }),\n);\n\napp.get(\n  '/login/wechat',\n  (req, res, next) => {\n    next();\n  },\n  passport.authenticate('wechat'),\n);\n\napp.get(\n  '/login/wechat/return',\n  passport.authenticate('wechat', {\n    session: false,\n    failureRedirect: '/login/wechat',\n  }),\n  (req, res) => {\n    const expiresIn = 60 * 60 * 24 * 180; // 180 days\n    const token = jwt.sign(req.user, config.auth.jwt.secret, { expiresIn });\n    res.cookie('id_token', token, { maxAge: 1000 * expiresIn, httpOnly: true });\n    res.redirect(req.session.next || '/');\n  },\n);\n\n//\n// Register API middleware\n// -----------------------------------------------------------------------------\nconst graphqlMiddleware = expressGraphQL(req => ({\n  schema,\n  graphiql: __DEV__,\n  rootValue: { request: req },\n  pretty: __DEV__,\n}));\n\napp.use('/graphql', graphqlMiddleware);\napp.use(connection());\n\n//\n// Register server-side rendering middleware\n// -----------------------------------------------------------------------------\napp.get('*', async (req, res, next) => {\n  try {\n    const css = new Set();\n\n    const apolloClient = createApolloClient({\n      schema,\n      rootValue: { request: req },\n    });\n\n    // Universal HTTP client\n    const fetch = createFetch(nodeFetch, {\n      baseUrl: config.api.serverUrl,\n      cookie: req.headers.cookie,\n      apolloClient,\n    });\n\n    const initialState = {\n      user: req.user || null,\n    };\n\n    const store = configureStore(initialState, {\n      cookie: req.headers.cookie,\n      fetch,\n      // I should not use `history` on server.. but how I do redirection? follow universal-router\n      history: null,\n    });\n\n    store.dispatch(\n      setRuntimeVariable({\n        name: 'initialNow',\n        value: Date.now(),\n      }),\n    );\n\n    // Global (context) variables that can be easily accessed from any React component\n    // https://facebook.github.io/react/docs/context.html\n    const context = {\n      // Enables critical path CSS rendering\n      // https://github.com/kriasoft/isomorphic-style-loader\n      insertCss: (...styles) => {\n        // eslint-disable-next-line no-underscore-dangle\n        styles.forEach(style => css.add(style._getCss()));\n      },\n      fetch,\n      // You can access redux through react-redux connect\n      store,\n      storeSubscription: null,\n      // Apollo Client for use with react-apollo\n      client: apolloClient,\n    };\n    const route = await router.resolve({\n      ...context,\n      pathname: req.path,\n      query: req.query,\n    });\n\n    if (route.redirect) {\n      if (route.from) {\n        req.session.next = route.from;\n      }\n      res.redirect(route.status || 302, route.redirect);\n      return;\n    }\n\n    const data = { ...route };\n    const rootComponent = (\n      <MuiThemeProvider\n        muiTheme={getMuiTheme({\n          userAgent: req.headers['user-agent'],\n        })}\n      >\n        <App\n          context={context}\n          store={store}\n          userAgent={req.headers['user-agent']}\n        >\n          {route.component}\n        </App>\n      </MuiThemeProvider>\n    );\n    await getDataFromTree(rootComponent);\n    // this is here because of Apollo redux APOLLO_QUERY_STOP action\n    await Promise.delay(0);\n    data.children = await ReactDOM.renderToString(rootComponent);\n    data.styles = [{ id: 'css', cssText: [...css].join('') }];\n\n    data.scripts = [assets.vendor.js];\n    data.scripts.push('//res.wx.qq.com/open/js/jweixin-1.2.0.js');\n    if (route.chunks) {\n      data.scripts.push(...route.chunks.map(chunk => assets[chunk].js));\n    }\n    data.scripts.push(assets.client.js);\n\n    // Furthermore invoked actions will be ignored, client will not receive them!\n    if (__DEV__) {\n      // eslint-disable-next-line no-console\n      console.log('Serializing store...');\n    }\n    data.app = {\n      apiUrl: config.api.clientUrl,\n      state: context.store.getState(),\n      apolloState: context.client.extract(),\n    };\n    data.hostname = req.hostname;\n\n    const html = ReactDOM.renderToStaticMarkup(<Html {...data} />);\n    res.status(route.status || 200);\n    res.send(`<!doctype html>${html}`);\n  } catch (err) {\n    next(err);\n  }\n});\n\n//\n// Error handling\n// -----------------------------------------------------------------------------\nconst pe = new PrettyError();\npe.skipNodeFiles();\npe.skipPackage('express');\n\n// eslint-disable-next-line no-unused-vars\napp.use((err, req, res, next) => {\n  console.error(pe.render(err));\n  const html = ReactDOM.renderToStaticMarkup(\n    <Html\n      title=\"Internal Server Error\"\n      description={err.message}\n      styles={[{ id: 'css', cssText: errorPageStyle._getCss() }]} // eslint-disable-line no-underscore-dangle\n    >\n      {ReactDOM.renderToString(<ErrorPageWithoutStyle error={err} />)}\n    </Html>,\n  );\n  res.status(err.status || 500);\n  res.send(`<!doctype html>${html}`);\n});\n\n//\n// Launch the server\n// -----------------------------------------------------------------------------\nconst promise = models.sync().catch(err => console.error(err.stack));\nif (!module.hot) {\n  promise.then(() => {\n    app.listen(config.port, () => {\n      console.info(`The server is running at http://localhost:${config.port}/`);\n    });\n  });\n}\n\n//\n// Hot Module Replacement\n// -----------------------------------------------------------------------------\nif (module.hot) {\n  app.hot = module.hot;\n  module.hot.accept('./router');\n}\n\nexport default app;\n\n\n\n// WEBPACK FOOTER //\n// ./src/server.js","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 24\n// module chunks = 7","module.exports = require(\"express-session\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-session\"\n// module id = 25\n// module chunks = 7","module.exports = require(\"connect-redis\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"connect-redis\"\n// module id = 26\n// module chunks = 7","module.exports = require(\"express-ws\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-ws\"\n// module id = 27\n// module chunks = 7","module.exports = require(\"cookie-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"cookie-parser\"\n// module id = 28\n// module chunks = 7","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 29\n// module chunks = 7","module.exports = require(\"express-jwt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-jwt\"\n// module id = 30\n// module chunks = 7","module.exports = require(\"express-graphql\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-graphql\"\n// module id = 31\n// module chunks = 7","module.exports = require(\"jsonwebtoken\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonwebtoken\"\n// module id = 32\n// module chunks = 7","module.exports = require(\"react-dom/server\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-dom/server\"\n// module id = 33\n// module chunks = 7","module.exports = require(\"pretty-error\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"pretty-error\"\n// module id = 34\n// module chunks = 7","module.exports = require(\"material-ui/styles/MuiThemeProvider\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"material-ui/styles/MuiThemeProvider\"\n// module id = 35\n// module chunks = 7","module.exports = require(\"material-ui/styles/getMuiTheme\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"material-ui/styles/getMuiTheme\"\n// module id = 36\n// module chunks = 7","// @flow\n\nimport { ApolloClient } from 'apollo-client';\nimport { from } from 'apollo-link';\nimport { onError } from 'apollo-link-error';\nimport { SchemaLink } from 'apollo-link-schema';\nimport createCache from './createCache';\n\nexport default function createApolloClient(schema) {\n  const link = from([\n    onError(({ graphQLErrors, networkError }) => {\n      if (graphQLErrors)\n        graphQLErrors.map(({ message, locations, path }) =>\n          console.warn(\n            `[GraphQL error]: Message: ${message}, Location: ${locations}, Path: ${path}`,\n          ),\n        );\n      if (networkError) console.warn(`[Network error]: ${networkError}`);\n    }),\n    new SchemaLink({ ...schema }),\n  ]);\n\n  return new ApolloClient({\n    link,\n    cache: createCache(),\n    ssrMode: true,\n    queryDeduplication: true,\n  });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/createApolloClient/createApolloClient.server.js","module.exports = require(\"apollo-client\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"apollo-client\"\n// module id = 38\n// module chunks = 7","module.exports = require(\"apollo-link\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"apollo-link\"\n// module id = 39\n// module chunks = 7","module.exports = require(\"apollo-link-error\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"apollo-link-error\"\n// module id = 40\n// module chunks = 7","module.exports = require(\"apollo-link-schema\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"apollo-link-schema\"\n// module id = 41\n// module chunks = 7","// @flow\n\nimport { InMemoryCache, defaultDataIdFromObject } from 'apollo-cache-inmemory';\n\nfunction dataIdFromObject(obj) {\n  switch (obj.__typename) {\n    case 'NewsItem':\n      return obj.link ? `NewsItem:${obj.link}` : defaultDataIdFromObject(obj);\n    default:\n      return defaultDataIdFromObject(obj);\n  }\n}\n\nexport default function createCache() {\n  // https://www.apollographql.com/docs/react/basics/caching.html#configuration\n  return new InMemoryCache({\n    dataIdFromObject,\n  });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/createApolloClient/createCache.js","module.exports = require(\"apollo-cache-inmemory\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"apollo-cache-inmemory\"\n// module id = 43\n// module chunks = 7","/**\n * React Starter Kit (https://www.reactstarterkit.com/)\n *\n * Copyright © 2014-present Kriasoft, LLC. All rights reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Provider as ReduxProvider } from 'react-redux';\nimport { ApolloProvider } from 'react-apollo';\n\nconst ContextType = {\n  // Enables critical path CSS rendering\n  // https://github.com/kriasoft/isomorphic-style-loader\n  insertCss: PropTypes.func.isRequired,\n  // Universal HTTP client\n  fetch: PropTypes.func.isRequired,\n  // Integrate Redux\n  // http://redux.js.org/docs/basics/UsageWithReact.html\n  ...ReduxProvider.childContextTypes,\n  // Apollo Client\n  client: PropTypes.object.isRequired,\n};\n\n/**\n * The top-level React component setting context (global) variables\n * that can be accessed from all the child components.\n *\n * https://facebook.github.io/react/docs/context.html\n *\n * Usage example:\n *\n *   const context = {\n *     history: createBrowserHistory(),\n *     store: createStore(),\n *   };\n *\n *   ReactDOM.render(\n *     <App context={context}>\n *       <Layout>\n *         <LandingPage />\n *       </Layout>\n *     </App>,\n *     container,\n *   );\n */\nclass App extends React.PureComponent {\n  static propTypes = {\n    context: PropTypes.shape(ContextType).isRequired,\n    children: PropTypes.element.isRequired,\n  };\n\n  static childContextTypes = ContextType;\n\n  getChildContext() {\n    return this.props.context;\n  }\n\n  render() {\n    // Here, we are at universe level, sure? ;-)\n    const { client } = this.props.context;\n    // NOTE: If you need to add or modify header, footer etc. of the app,\n    // please do that inside the Layout component.\n    return (\n      <ApolloProvider client={client}>{this.props.children}</ApolloProvider>\n    );\n  }\n}\n\nexport default App;\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/App.js","module.exports = require(\"react-redux\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-redux\"\n// module id = 45\n// module chunks = 7","/**\n * React Starter Kit (https://www.reactstarterkit.com/)\n *\n * Copyright © 2014-present Kriasoft, LLC. All rights reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport serialize from 'serialize-javascript';\nimport config from '../config';\n\n/* eslint-disable react/no-danger */\n\nclass Html extends React.Component {\n  static propTypes = {\n    title: PropTypes.string.isRequired,\n    description: PropTypes.string.isRequired,\n    styles: PropTypes.arrayOf(\n      PropTypes.shape({\n        id: PropTypes.string.isRequired,\n        cssText: PropTypes.string.isRequired,\n      }).isRequired,\n    ),\n    scripts: PropTypes.arrayOf(PropTypes.string.isRequired),\n    app: PropTypes.object, // eslint-disable-line\n    children: PropTypes.string.isRequired,\n    hostname: PropTypes.string,\n  };\n\n  static defaultProps = {\n    styles: [],\n    scripts: [],\n    hostname: null,\n  };\n\n  assetsMap(asset) {\n    if (asset.startsWith('/assets/') && this.props.hostname) {\n      const domain = this.props.hostname.split('.');\n      if (domain[domain.length - 2]) {\n        return `//assets.${domain[domain.length - 2]}.${\n          domain[domain.length - 1]\n        }${asset}`;\n      }\n      return `//assets.${domain[domain.length - 1]}${asset}`;\n    }\n    return asset;\n  }\n\n  render() {\n    const { title, description, styles, scripts, app, children } = this.props;\n    return (\n      <html className=\"no-js\" lang=\"en\">\n        <head>\n          <meta charSet=\"utf-8\" />\n          <meta httpEquiv=\"x-ua-compatible\" content=\"ie=edge\" />\n          <title>{title}</title>\n          <meta name=\"description\" content={description} />\n          <meta\n            name=\"viewport\"\n            content=\"width=device-width, initial-scale = 1.0, maximum-scale=1.0, user-scalable=no\"\n          />\n          <meta name=\"apple-mobile-web-app-capable\" content=\"yes\" />\n          {scripts.map(script => (\n            <link\n              key={script}\n              rel=\"preload\"\n              href={this.assetsMap(script)}\n              as=\"script\"\n            />\n          ))}\n          <link rel=\"apple-touch-icon\" href=\"apple-touch-icon.png\" />\n          {styles.map(style => (\n            <style\n              key={style.id}\n              id={style.id}\n              dangerouslySetInnerHTML={{ __html: style.cssText }}\n            />\n          ))}\n        </head>\n        <body>\n          <div id=\"app\" dangerouslySetInnerHTML={{ __html: children }} />\n          <script\n            dangerouslySetInnerHTML={{ __html: `window.App=${serialize(app)}` }}\n          />\n          {scripts.map(script => (\n            <script key={script} src={this.assetsMap(script)} />\n          ))}\n          {config.analytics &&\n            config.analytics.googleTrackingId && (\n              <script\n                dangerouslySetInnerHTML={{\n                  __html:\n                    'window.ga=function(){ga.q.push(arguments)};ga.q=[];ga.l=+new Date;' +\n                    `ga('create','${\n                      config.analytics.googleTrackingId\n                    }','auto');ga('send','pageview')`,\n                }}\n              />\n            )}\n          {config.analytics &&\n            config.analytics.googleTrackingId && (\n              <script\n                src=\"https://www.google-analytics.com/analytics.js\"\n                async\n                defer\n              />\n            )}\n        </body>\n      </html>\n    );\n  }\n}\n\nexport default Html;\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/Html.js","module.exports = require(\"serialize-javascript\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"serialize-javascript\"\n// module id = 47\n// module chunks = 7","/**\n * React Starter Kit (https://www.reactstarterkit.com/)\n *\n * Copyright © 2014-present Kriasoft, LLC. All rights reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport withStyles from 'isomorphic-style-loader/lib/withStyles';\nimport s from './ErrorPage.css';\n\nclass ErrorPage extends React.Component {\n  static propTypes = {\n    error: PropTypes.shape({\n      name: PropTypes.string.isRequired,\n      message: PropTypes.string.isRequired,\n      stack: PropTypes.string.isRequired,\n    }),\n  };\n\n  static defaultProps = {\n    error: null,\n  };\n\n  render() {\n    if (__DEV__ && this.props.error) {\n      return (\n        <div>\n          <h1>{this.props.error.name}</h1>\n          <pre>{this.props.error.stack}</pre>\n        </div>\n      );\n    }\n\n    return (\n      <div>\n        <h1>Error</h1>\n        <p>Sorry, a critical error occurred on this page.</p>\n      </div>\n    );\n  }\n}\n\nexport { ErrorPage as ErrorPageWithoutStyle };\nexport default withStyles(s)(ErrorPage);\n\n\n\n// WEBPACK FOOTER //\n// ./src/routes/error/ErrorPage.js","exports = module.exports = require(\"../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"html{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;padding:0 32px;padding:0 2rem;height:100%;font-family:sans-serif;text-align:center;color:#888}body{margin:0}h1{font-weight:400;color:#555}pre{white-space:pre-wrap;text-align:left}\", \"\"]);\n\n// exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/css-loader?{\"importLoaders\":1,\"sourceMap\":false,\"modules\":true,\"localIdentName\":\"[hash:base64:5]\",\"minimize\":{\"discardComments\":{\"removeAll\":true}}}!./node_modules/postcss-loader/lib?{\"config\":{\"path\":\"./tools/postcss.config.js\"}}!./src/routes/error/ErrorPage.css\n// module id = 49\n// module chunks = 7","module.exports = require(\"babel-runtime/core-js/json/stringify\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/json/stringify\"\n// module id = 50\n// module chunks = 7","module.exports = require(\"babel-runtime/helpers/slicedToArray\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/slicedToArray\"\n// module id = 51\n// module chunks = 7","/**\n * React Starter Kit (https://www.reactstarterkit.com/)\n *\n * Copyright © 2014-present Kriasoft, LLC. All rights reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\n/* @flow */\n\ntype Fetch = (url: string, options: ?any) => Promise<any>;\n\ntype Options = {\n  baseUrl: string,\n  cookie?: string,\n};\n\n/**\n * Creates a wrapper function around the HTML5 Fetch API that provides\n * default arguments to fetch(...) and is intended to reduce the amount\n * of boilerplate code in the application.\n * https://developer.mozilla.org/docs/Web/API/Fetch_API/Using_Fetch\n */\nfunction createFetch(fetch: Fetch, { baseUrl, cookie }: Options) {\n  // NOTE: Tweak the default options to suite your application needs\n  const defaults = {\n    method: 'POST', // handy with GraphQL backends\n    mode: baseUrl ? 'cors' : 'same-origin',\n    credentials: baseUrl ? 'include' : 'same-origin',\n    headers: {\n      Accept: 'application/json',\n      'Content-Type': 'application/json',\n      ...(cookie ? { Cookie: cookie } : null),\n    },\n  };\n\n  return (url: string, options: any) =>\n    url.startsWith('/graphql') || url.startsWith('/api')\n      ? fetch(`${baseUrl}${url}`, {\n          ...defaults,\n          ...options,\n          headers: {\n            ...defaults.headers,\n            ...(options && options.headers),\n          },\n        })\n      : fetch(url, options);\n}\n\nexport default createFetch;\n\n\n\n// WEBPACK FOOTER //\n// ./src/createFetch.js","import express from 'express';\nimport GameEngine from 'game-engine';\nimport fetch from 'node-fetch';\nimport config from './config';\nimport { User, UserProfile } from './data/models';\n\nimport { redis, subscriber } from './redis';\n\nconst re = new RegExp('^(B|W)[a-z]* wins by ([\\\\d\\\\.]+) points');\n\nconst channels = {};\n\nsubscriber.on('message', (channel, message) => {\n  const chan = channel.split(':')[1];\n  channels[chan].forEach(ws => {\n    ws.send(message);\n  });\n});\n\nexport default function() {\n  const router = express.Router();\n  router.ws('/channel/:channel', (ws, req) => {\n    ws.on('message', data => {\n      const msg = JSON.parse(data);\n      Promise.all([\n        redis.getAsync(`engine:${ws.channel}`),\n        redis.hgetallAsync(`info:${ws.channel}`),\n        redis.lrangeAsync(`moves:${ws.channel}`, 0, -1),\n      ]).then(([rule, info, moves]) => {\n        const engine = new GameEngine[rule](info, moves.map(JSON.parse));\n        const result = engine[msg.type](\n          msg.color,\n          msg.position && msg.position[0],\n          msg.position && msg.position[1],\n        );\n        if (\n          typeof result === 'number' ||\n          (typeof result === 'boolean' && result)\n        ) {\n          redis\n            .rpushAsync(`moves:${ws.channel}`, JSON.stringify(msg))\n            .then(() =>\n              redis.publishAsync(\n                `channel:${ws.channel}`,\n                JSON.stringify({\n                  code: 'ok',\n                  type: 'delta',\n                  move: msg,\n                }),\n              ),\n            )\n            .then(() => {\n              switch (msg.type) {\n                case 'pass':\n                  if (\n                    engine.currentColor() !== GameEngine.Go.COLOR.BLACK &&\n                    engine.currentColor() !== GameEngine.Go.COLOR.WHITE\n                  ) {\n                    fetch(config.gnugo, {\n                      method: 'POST',\n                      body: engine.toSgf(),\n                    })\n                      .then(res => res.text())\n                      .then(text => {\n                        const r = text.match(re);\n                        if (r) {\n                          redis\n                            .hsetAsync(\n                              `info:${ws.channel}`,\n                              'result',\n                              `${r[1]}+${r[2]}`,\n                            )\n                            .then(() => {\n                              redis.publishAsync(\n                                `channel:${ws.channel}`,\n                                JSON.stringify({\n                                  code: 'ok',\n                                  type: 'result',\n                                  result: `${r[1]}+${r[2]}`,\n                                }),\n                              );\n                            });\n                        }\n                      });\n                  }\n                  break;\n                case 'resign':\n                  redis\n                    .hsetAsync(\n                      `info:${ws.channel}`,\n                      'result',\n                      `${\n                        msg.color === GameEngine.Go.COLOR.BLACK ? 'W+R' : 'B+R'\n                      }`,\n                    )\n                    .then(() => {\n                      redis.publishAsync(\n                        `channel:${ws.channel}`,\n                        JSON.stringify({\n                          code: 'ok',\n                          type: 'result',\n                          result: `${\n                            msg.color === GameEngine.Go.COLOR.BLACK\n                              ? 'W+R'\n                              : 'B+R'\n                          }`,\n                        }),\n                      );\n                    });\n                  break;\n                default:\n                  break;\n              }\n            });\n        }\n      });\n    });\n\n    ws.on('close', () => {\n      if (ws.channel) {\n        const channel = channels[ws.channel];\n        channel.splice(channel.indexOf(ws), 1);\n        if (channel.length === 0) {\n          delete channels[ws.channel];\n          subscriber.unsubscribe(`channel:${ws.channel}`);\n        }\n        // eslint-disable-next-line no-param-reassign\n        delete ws.channel;\n      }\n    });\n\n    (() => {\n      // quit prev channel\n      if (!channels[req.params.channel]) {\n        subscriber.subscribe(`channel:${req.params.channel}`);\n        channels[req.params.channel] = [];\n      }\n      if (ws.channel) {\n        const channel = channels[ws.channel];\n        channel.splice(channel.indexOf(ws), 1);\n      }\n      // subscribe to new channel\n      channels[req.params.channel].push(ws);\n      // eslint-disable-next-line no-param-reassign\n      ws.channel = req.params.channel;\n      // send new game info\n      Promise.all([\n        redis.getAsync(`engine:${ws.channel}`),\n        redis.hgetallAsync(`info:${ws.channel}`),\n        redis.lrangeAsync(`moves:${ws.channel}`, 0, -1),\n      ]).then(([engine, info, moves]) => {\n        User.findAll({\n          where: { id: { $in: [info.black, info.white] } },\n          include: [\n            {\n              attributes: ['displayName', 'picture'],\n              model: UserProfile,\n              as: 'profile',\n              required: true,\n            },\n          ],\n        }).then(users => {\n          const players = users.filter(e => e).map(user => {\n            const u = user.get({ plain: true });\n            return {\n              id: u.id,\n              displayName: u.profile.displayName,\n              picture: u.profile.picture,\n            };\n          });\n          let profile = {};\n          // eslint-disable-next-line no-restricted-syntax\n          for (const player of players) {\n            profile = Object.assign(profile, {\n              [player.id]: player,\n            });\n          }\n          ws.send(\n            JSON.stringify({\n              code: 'ok',\n              type: 'init',\n              game: {\n                engine,\n                moves: moves.map(JSON.parse),\n                info: {\n                  result: info.result,\n                  boardsize: info.boardsize,\n                  black: {\n                    id: info.black,\n                    name: profile[info.black]\n                      ? profile[info.black].displayName\n                      : '[黑棋]',\n                    avatar: profile[info.black]\n                      ? profile[info.black].picture\n                      : 'http://wx.qlogo.cn/mmopen/jj4e65x0Px2ibxI8cBsLdxueOibCLrqHvg9U91Dvk0ohjQHgO2dias3LiaHazszmh0CJX4xhknnfwibqwDwWfCBaVPslgIcyBG81A/64',\n                  },\n                  white: {\n                    id: info.white,\n                    name: profile[info.white]\n                      ? profile[info.white].displayName\n                      : '[白棋]',\n                    avatar: profile[info.white]\n                      ? profile[info.white].picture\n                      : 'http://wx.qlogo.cn/mmopen/jj4e65x0Px2ibxI8cBsLdxueOibCLrqHvg9U91Dvk0ohjQHgO2dias3LiaHazszmh0CJX4xhknnfwibqwDwWfCBaVPslgIcyBG81A/64',\n                  },\n                },\n              },\n            }),\n          );\n        });\n      });\n    })();\n  });\n  return router;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/connection.js","/**\n * React Starter Kit (https://www.reactstarterkit.com/)\n *\n * Copyright © 2014-present Kriasoft, LLC. All rights reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nimport DataType from 'sequelize';\nimport Model from '../sequelize';\n\nconst User = Model.define(\n  'User',\n  {\n    id: {\n      type: DataType.UUID,\n      defaultValue: DataType.UUIDV1,\n      primaryKey: true,\n    },\n\n    email: {\n      type: DataType.STRING(255),\n      validate: { isEmail: true },\n    },\n\n    emailConfirmed: {\n      type: DataType.BOOLEAN,\n      defaultValue: false,\n    },\n  },\n  {\n    indexes: [{ fields: ['email'] }],\n  },\n);\n\nexport default User;\n\n\n\n// WEBPACK FOOTER //\n// ./src/data/models/User.js","/**\n * React Starter Kit (https://www.reactstarterkit.com/)\n *\n * Copyright © 2014-present Kriasoft, LLC. All rights reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nimport DataType from 'sequelize';\nimport Model from '../sequelize';\n\nconst UserLogin = Model.define('UserLogin', {\n  name: {\n    type: DataType.STRING(50),\n    primaryKey: true,\n  },\n\n  key: {\n    type: DataType.STRING(100),\n    primaryKey: true,\n  },\n});\n\nexport default UserLogin;\n\n\n\n// WEBPACK FOOTER //\n// ./src/data/models/UserLogin.js","/**\n * React Starter Kit (https://www.reactstarterkit.com/)\n *\n * Copyright © 2014-present Kriasoft, LLC. All rights reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nimport DataType from 'sequelize';\nimport Model from '../sequelize';\n\nconst UserClaim = Model.define('UserClaim', {\n  type: {\n    type: DataType.STRING,\n  },\n\n  value: {\n    type: DataType.STRING,\n  },\n});\n\nexport default UserClaim;\n\n\n\n// WEBPACK FOOTER //\n// ./src/data/models/UserClaim.js","/**\n * React Starter Kit (https://www.reactstarterkit.com/)\n *\n * Copyright © 2014-present Kriasoft, LLC. All rights reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nimport DataType from 'sequelize';\nimport Model from '../sequelize';\n\nconst UserProfile = Model.define('UserProfile', {\n  userId: {\n    type: DataType.UUID,\n    primaryKey: true,\n  },\n\n  displayName: {\n    type: DataType.STRING(100),\n  },\n\n  picture: {\n    type: DataType.STRING(255),\n  },\n\n  gender: {\n    type: DataType.STRING(50),\n  },\n\n  location: {\n    type: DataType.STRING(100),\n  },\n\n  website: {\n    type: DataType.STRING(255),\n  },\n});\n\nexport default UserProfile;\n\n\n\n// WEBPACK FOOTER //\n// ./src/data/models/UserProfile.js","module.exports = require(\"redis\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"redis\"\n// module id = 58\n// module chunks = 7","/**\n * React Starter Kit (https://www.reactstarterkit.com/)\n *\n * Copyright © 2014-present Kriasoft, LLC. All rights reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\n/**\n * Passport.js reference implementation.\n * The database schema used in this sample is available at\n * https://github.com/membership/membership.db/tree/master/postgres\n */\n\nimport passport from 'passport';\nimport { Strategy as WechatStrategy } from 'passport-wechat';\nimport { User, UserLogin, UserClaim, UserProfile } from './data/models';\nimport config from './config';\n\npassport.use(\n  new WechatStrategy(\n    {\n      appID: config.wechat.appId,\n      appSecret: config.wechat.appSecret,\n      callbackURL: 'http://shoutanwq.com/login/wechat/return',\n      client: 'wechat',\n      scope: 'snsapi_userinfo',\n      passReqToCallback: true,\n    },\n    (req, accessToken, refreshToken, profile, expiredIn, done) => {\n      /* eslint-disable no-underscore-dangle */\n      const loginName = 'wechat';\n      const claimType = 'urn:wechat:access_token';\n      const id = profile.unionid || profile.openid;\n      const fooBar = async () => {\n        if (req.user) {\n          const userLogin = await UserLogin.findOne({\n            attributes: ['name', 'key'],\n            where: { name: loginName, key: id },\n          });\n          if (userLogin) {\n            // There is already a Facebook account that belongs to you.\n            // Sign in with that account or delete it, then link it with your current account.\n            done();\n          } else {\n            const user = await User.create(\n              {\n                id: req.user.id,\n                email: `${id}@wechat.account.shoutanwq.com.`,\n                logins: [{ name: loginName, key: id }],\n                claims: [{ type: claimType, value: id }],\n                profile: {\n                  displayName: profile.nickname,\n                  gender: profile.sex,\n                  picture: profile.headimgurl,\n                },\n              },\n              {\n                include: [\n                  { model: UserLogin, as: 'logins' },\n                  { model: UserClaim, as: 'claims' },\n                  { model: UserProfile, as: 'profile' },\n                ],\n              },\n            );\n            done(null, {\n              id: user.id,\n              email: user.email,\n            });\n          }\n        } else {\n          const users = await User.findAll({\n            attributes: ['id', 'email'],\n            where: { '$logins.name$': loginName, '$logins.key$': id },\n            include: [\n              {\n                attributes: ['name', 'key'],\n                model: UserLogin,\n                as: 'logins',\n                required: true,\n              },\n            ],\n          });\n          if (users.length) {\n            const user = users[0].get({ plain: true });\n            done(null, user);\n          } else {\n            let user = await User.findOne({\n              where: { email: `${id}@wechat.account.shoutanwq.com` },\n            });\n            if (user) {\n              // There is already an account using this email address. Sign in to\n              // that account and link it with Facebook manually from Account Settings.\n              done(null);\n            } else {\n              user = await User.create(\n                {\n                  email: `${id}@wechat.account.shoutanwq.com`,\n                  emailConfirmed: true,\n                  logins: [{ name: loginName, key: id }],\n                  claims: [{ type: claimType, value: accessToken }],\n                  profile: {\n                    displayName: profile.nickname,\n                    gender: profile.sex,\n                    picture: profile.headimgurl,\n                  },\n                },\n                {\n                  include: [\n                    { model: UserLogin, as: 'logins' },\n                    { model: UserClaim, as: 'claims' },\n                    { model: UserProfile, as: 'profile' },\n                  ],\n                },\n              );\n              done(null, {\n                id: user.id,\n                email: user.email,\n              });\n            }\n          }\n        }\n      };\n      fooBar().catch(done);\n    },\n  ),\n);\n\nexport default passport;\n\n\n\n// WEBPACK FOOTER //\n// ./src/passport.js","module.exports = require(\"passport\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"passport\"\n// module id = 60\n// module chunks = 7","module.exports = require(\"passport-wechat\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"passport-wechat\"\n// module id = 61\n// module chunks = 7","/**\n * React Starter Kit (https://www.reactstarterkit.com/)\n *\n * Copyright © 2014-present Kriasoft, LLC. All rights reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nimport UniversalRouter from 'universal-router';\nimport querystring from 'querystring';\nimport routes from './routes';\n\nexport default new UniversalRouter(routes, {\n  resolveRoute(context, params) {\n    if (context.route.protected && !context.store.getState().user) {\n      return {\n        redirect: '/login/wechat',\n        from: `${context.pathname}?${querystring.stringify(context.query)}`,\n      };\n    }\n    if (typeof context.route.load === 'function') {\n      return context.route\n        .load()\n        .then(action => action.default(context, params));\n    }\n    if (typeof context.route.action === 'function') {\n      return context.route.action(context, params);\n    }\n    return undefined;\n  },\n});\n\n\n\n// WEBPACK FOOTER //\n// ./src/router.js","module.exports = require(\"universal-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"universal-router\"\n// module id = 63\n// module chunks = 7","/**\n * React Starter Kit (https://www.reactstarterkit.com/)\n *\n * Copyright © 2014-present Kriasoft, LLC. All rights reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\n/* eslint-disable global-require */\n\n// The top-level (parent) route\nconst routes = {\n  path: '',\n\n  // Keep in mind, routes are evaluated in order\n  children: [\n    {\n      path: '',\n      load: () => import(/* webpackChunkName: 'home' */ './home'),\n    },\n    {\n      path: '/login',\n      load: () => import(/* webpackChunkName: 'login' */ './login'),\n    },\n    {\n      path: '/about',\n      load: () => import(/* webpackChunkName: 'about' */ './about'),\n    },\n    {\n      path: '/admin',\n      load: () => import(/* webpackChunkName: 'admin' */ './admin'),\n    },\n    {\n      path: '/go',\n      protected: true,\n      children: [\n        {\n          path: '/creation',\n          load: () =>\n            import(/* webpackChunkName: 'go-creation' */ './go-creation'),\n        },\n        {\n          path: '',\n          load: () => import(/* webpackChunkName: 'go' */ './go'),\n        },\n      ],\n    },\n    // Wildcard routes, e.g. { path: '(.*)', ... } (must go last)\n    {\n      path: '(.*)',\n      load: () => import(/* webpackChunkName: 'not-found' */ './not-found'),\n    },\n  ],\n\n  async action({ next }) {\n    // Execute each child route until one of them return the result\n    const route = await next();\n\n    // Provide default values for title, description etc.\n    route.title = `${route.title || 'Untitled Page'} - 手谈围棋`;\n    route.description = route.description || '';\n\n    return route;\n  },\n};\n\n// The error page is available by permanent url for development mode\nif (__DEV__) {\n  routes.children.unshift({\n    path: '/error',\n    action: require('./error').default,\n  });\n}\n\nexport default routes;\n\n\n\n// WEBPACK FOOTER //\n// ./src/routes/index.js","/**\n * React Starter Kit (https://www.reactstarterkit.com/)\n *\n * Copyright © 2014-present Kriasoft, LLC. All rights reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nimport {\n  GraphQLSchema as Schema,\n  GraphQLObjectType as ObjectType,\n} from 'graphql';\n\nimport me from './queries/me';\nimport news from './queries/news';\nimport go from './queries/go';\nimport wechat from './queries/wechat';\n\nimport create from './mutations/create';\nimport update from './mutations/update';\n\nconst schema = new Schema({\n  query: new ObjectType({\n    name: 'Query',\n    fields: {\n      me,\n      go,\n      news,\n      wechat,\n    },\n  }),\n  mutation: new ObjectType({\n    name: 'Mutation',\n    fields: {\n      createGo: create,\n      updateGo: update,\n    },\n  }),\n});\n\nexport default schema;\n\n\n\n// WEBPACK FOOTER //\n// ./src/data/schema.js","/**\n * React Starter Kit (https://www.reactstarterkit.com/)\n *\n * Copyright © 2014-present Kriasoft, LLC. All rights reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nimport UserType from '../types/UserType';\n\nconst me = {\n  type: UserType,\n  resolve({ request }) {\n    return (\n      request.user && {\n        id: request.user.id,\n        email: request.user.email,\n      }\n    );\n  },\n};\n\nexport default me;\n\n\n\n// WEBPACK FOOTER //\n// ./src/data/queries/me.js","/**\n * React Starter Kit (https://www.reactstarterkit.com/)\n *\n * Copyright © 2014-present Kriasoft, LLC. All rights reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nimport {\n  GraphQLObjectType as ObjectType,\n  GraphQLID as ID,\n  GraphQLString as StringType,\n  GraphQLNonNull as NonNull,\n} from 'graphql';\n\nconst UserType = new ObjectType({\n  name: 'User',\n  fields: {\n    id: { type: new NonNull(ID) },\n    email: { type: StringType },\n  },\n});\n\nexport default UserType;\n\n\n\n// WEBPACK FOOTER //\n// ./src/data/types/UserType.js","/**\n * React Starter Kit (https://www.reactstarterkit.com/)\n *\n * Copyright © 2014-present Kriasoft, LLC. All rights reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nimport { GraphQLList as List } from 'graphql';\nimport fetch from 'node-fetch';\nimport NewsItemType from '../types/NewsItemType';\n\n// React.js News Feed (RSS)\nconst url =\n  'https://api.rss2json.com/v1/api.json' +\n  '?rss_url=https%3A%2F%2Freactjsnews.com%2Ffeed.xml';\n\nlet items = [];\nlet lastFetchTask;\nlet lastFetchTime = new Date(1970, 0, 1);\n\nconst news = {\n  type: new List(NewsItemType),\n  resolve() {\n    if (lastFetchTask) {\n      return lastFetchTask;\n    }\n\n    if (new Date() - lastFetchTime > 1000 * 60 * 10 /* 10 mins */) {\n      lastFetchTime = new Date();\n      lastFetchTask = fetch(url)\n        .then(response => response.json())\n        .then(data => {\n          if (data.status === 'ok') {\n            items = data.items;\n          }\n\n          lastFetchTask = null;\n          return items;\n        })\n        .catch(err => {\n          lastFetchTask = null;\n          throw err;\n        });\n\n      if (items.length) {\n        return items;\n      }\n\n      return lastFetchTask;\n    }\n\n    return items;\n  },\n};\n\nexport default news;\n\n\n\n// WEBPACK FOOTER //\n// ./src/data/queries/news.js","/**\n * React Starter Kit (https://www.reactstarterkit.com/)\n *\n * Copyright © 2014-present Kriasoft, LLC. All rights reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nimport {\n  GraphQLObjectType as ObjectType,\n  GraphQLString as StringType,\n  GraphQLNonNull as NonNull,\n} from 'graphql';\n\nconst NewsItemType = new ObjectType({\n  name: 'NewsItem',\n  fields: {\n    title: { type: new NonNull(StringType) },\n    link: { type: new NonNull(StringType) },\n    author: { type: StringType },\n    pubDate: { type: new NonNull(StringType) },\n    content: { type: StringType },\n  },\n});\n\nexport default NewsItemType;\n\n\n\n// WEBPACK FOOTER //\n// ./src/data/types/NewsItemType.js","/**\n * @author lookis on 17/01/2018\n */\n\nimport { GraphQLNonNull, GraphQLString } from 'graphql';\nimport GoType from '../types/GoType';\nimport { redis } from '../../redis';\n\nconst Go = {\n  type: GoType,\n  args: {\n    id: {\n      type: new GraphQLNonNull(GraphQLString),\n    },\n  },\n  resolve(root, { id }) {\n    return Promise.all([\n      redis.getAsync(`engine:${id}`),\n      redis.hgetallAsync(`info:${id}`),\n    ]).then(([engine, info]) => ({\n      id,\n      engine,\n      info,\n    }));\n  },\n};\n\nexport default Go;\n\n\n\n// WEBPACK FOOTER //\n// ./src/data/queries/go.js","import fetch from 'node-fetch';\nimport crypto from 'crypto';\nimport querystring from 'querystring';\nimport { GraphQLNonNull, GraphQLString } from 'graphql';\nimport WechatType from '../types/WechatType';\nimport config from '../../config';\nimport { redis } from '../../redis';\n\nconst sign = function(payload) {\n  const algo = crypto.createHash('sha1');\n  const ordered = {};\n  Object.keys(payload)\n    .sort()\n    .forEach(key => {\n      if (payload[key] && key !== 'signature') {\n        ordered[key] = payload[key];\n      }\n    });\n  const stringA = querystring.unescape(querystring.stringify(ordered));\n  algo.update(stringA);\n  return algo.digest('hex');\n};\n\nconst wechat = {\n  type: WechatType,\n  args: {\n    url: { type: new GraphQLNonNull(GraphQLString) },\n  },\n  resolve(root, { url }) {\n    return redis\n      .getAsync('jsapi_ticket')\n      .then(ticket => {\n        if (!ticket) {\n          return redis\n            .getAsync('wechat_accessToken')\n            .then(accessToken => {\n              if (!accessToken) {\n                return fetch(\n                  `https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=${\n                    config.wechat.appId\n                  }&secret=${config.wechat.appSecret}`,\n                )\n                  .then(response => response.json())\n                  .then(json => {\n                    if (json.errcode && json.errcode === 0) {\n                      return redis\n                        .setexAsync(\n                          'wechat_accessToken',\n                          json.expires_in,\n                          json.access_token,\n                        )\n                        .then(() => json.access_token);\n                    }\n                    throw json;\n                  });\n              }\n              return accessToken;\n            })\n            .then(accessToken =>\n              fetch(\n                `https://api.weixin.qq.com/cgi-bin/ticket/getticket?access_token=${accessToken}&type=jsapi`,\n              )\n                .then(response => response.json())\n                .then(json => {\n                  if (json.errcode && json.errcode === 0) {\n                    return redis\n                      .setexAsync('jsapi_ticket', json.expires_in, json.ticket)\n                      .then(() => json.ticket);\n                  }\n                  throw json;\n                }),\n            );\n        }\n        return ticket;\n      })\n      .then(ticket => {\n        const noncestr = Math.random().toString();\n        const timestamp = Math.floor(new Date().getTime() / 1000);\n        const signature = sign({\n          jsapi_ticket: ticket,\n          url,\n          noncestr,\n          timestamp,\n        });\n        return {\n          appId: config.wechat.appId,\n          timestamp,\n          nonceStr: noncestr,\n          signature,\n        };\n      })\n      .catch(e => {\n        console.error(e);\n        const noncestr = Math.random().toString();\n        const timestamp = Math.floor(new Date().getTime() / 1000);\n        return {\n          appId: config.wechat.appId,\n          timestamp,\n          nonceStr: noncestr,\n          signature: e.errmsg || e.errcode || 'error',\n        };\n      });\n  },\n};\n\nexport default wechat;\n\n\n\n// WEBPACK FOOTER //\n// ./src/data/queries/wechat.js","module.exports = require(\"crypto\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"crypto\"\n// module id = 72\n// module chunks = 7","import { GraphQLObjectType, GraphQLString, GraphQLInt } from 'graphql';\n\nconst WechatType = new GraphQLObjectType({\n  name: 'Wechat',\n  fields: {\n    appId: {\n      type: GraphQLString,\n    },\n    timestamp: {\n      type: GraphQLInt,\n    },\n    nonceStr: {\n      type: GraphQLString,\n    },\n    signature: {\n      type: GraphQLString,\n    },\n  },\n});\n\nexport default WechatType;\n\n\n\n// WEBPACK FOOTER //\n// ./src/data/types/WechatType.js","import {\n  GraphQLString,\n  GraphQLNonNull,\n  GraphQLInt,\n  GraphQLFloat,\n} from 'graphql';\nimport GoType from '../types/GoType';\n\nimport { redis } from '../../redis';\n\nconst createGo = {\n  type: GoType,\n  args: {\n    rule: { type: new GraphQLNonNull(GraphQLString) },\n    boardsize: {\n      type: new GraphQLNonNull(GraphQLInt),\n    },\n    handicap: {\n      type: GraphQLInt,\n    },\n    komi: {\n      type: GraphQLFloat,\n    },\n    color: { type: GraphQLString },\n  },\n  resolve: (root, { rule, boardsize, handicap, komi, color }) => {\n    const id = Math.random()\n      .toString(16)\n      .split('.')[1];\n    return Promise.all([\n      redis.setAsync(`engine:${id}`, rule),\n      redis.hmsetAsync(\n        `info:${id}`,\n        Object.assign(\n          {\n            boardsize,\n            handicap: handicap || 0,\n            komi: komi || 6.5,\n          },\n          color === 'black'\n            ? { black: root.request.user.id }\n            : { white: root.request.user.id },\n        ),\n      ),\n    ]).then(() => ({\n      id,\n      engine: rule,\n      info: {\n        boardsize,\n        black: color === 'black' ? root.request.user.id : null,\n        white: color === 'white' ? root.request.user.id : null,\n      },\n    }));\n  },\n};\n\nexport default createGo;\n\n\n\n// WEBPACK FOOTER //\n// ./src/data/mutations/create.js","import { GraphQLString, GraphQLNonNull } from 'graphql';\nimport GoType from '../types/GoType';\n\nimport { redis } from '../../redis';\nimport { User, UserProfile } from '../models';\n\nconst updateGo = {\n  type: GoType,\n  args: {\n    id: { type: new GraphQLNonNull(GraphQLString) },\n    color: { type: GraphQLString },\n  },\n  resolve: (root, { id, color }) =>\n    redis\n      .hmgetAsync(`info:${id}`, color, 'black', 'white')\n      .then(([r, black, white]) => {\n        if (\n          !r &&\n          root.request.user &&\n          black !== root.request.user.id &&\n          white !== root.request.user.id\n        ) {\n          return redis.hsetAsync(`info:${id}`, color, root.request.user.id);\n        }\n        return Promise.resolve(true);\n      })\n      // publish join\n      .then(() =>\n        Promise.all([\n          redis.getAsync(`engine:${id}`),\n          redis.hgetallAsync(`info:${id}`),\n          redis.lrangeAsync(`moves:${id}`, 0, -1),\n        ]).then(([engine, info, moves]) =>\n          User.findAll({\n            where: { id: { $in: [info.black, info.white] } },\n            include: [\n              {\n                attributes: ['displayName', 'picture'],\n                model: UserProfile,\n                as: 'profile',\n                required: true,\n              },\n            ],\n          }).then(users => {\n            const players = users.filter(e => e).map(user => {\n              const u = user.get({ plain: true });\n              return {\n                id: u.id,\n                displayName: u.profile.displayName,\n                picture: u.profile.picture,\n              };\n            });\n            let profile = {};\n            // eslint-disable-next-line no-restricted-syntax\n            for (const player of players) {\n              profile = Object.assign(profile, {\n                [player.id]: player,\n              });\n            }\n            return redis\n              .publishAsync(\n                `channel:${id}`,\n                JSON.stringify({\n                  code: 'ok',\n                  type: 'init',\n                  game: {\n                    engine,\n                    moves: moves.map(JSON.parse),\n                    info: {\n                      result: info.result,\n                      boardsize: info.boardsize,\n                      black: {\n                        id: info.black,\n                        name: profile[info.black]\n                          ? profile[info.black].displayName\n                          : '[黑棋]',\n                        avatar: profile[info.black]\n                          ? profile[info.black].picture\n                          : 'http://wx.qlogo.cn/mmopen/jj4e65x0Px2ibxI8cBsLdxueOibCLrqHvg9U91Dvk0ohjQHgO2dias3LiaHazszmh0CJX4xhknnfwibqwDwWfCBaVPslgIcyBG81A/64',\n                      },\n                      white: {\n                        id: info.white,\n                        name: profile[info.white]\n                          ? profile[info.white].displayName\n                          : '[白棋]',\n                        avatar: profile[info.white]\n                          ? profile[info.white].picture\n                          : 'http://wx.qlogo.cn/mmopen/jj4e65x0Px2ibxI8cBsLdxueOibCLrqHvg9U91Dvk0ohjQHgO2dias3LiaHazszmh0CJX4xhknnfwibqwDwWfCBaVPslgIcyBG81A/64',\n                      },\n                    },\n                  },\n                }),\n              )\n              .then(() => Promise.resolve([engine, info]));\n          }),\n        ),\n      )\n      // return info\n      .then(([engine, info]) => ({\n        id,\n        engine,\n        info,\n      })),\n};\n\nexport default updateGo;\n\n\n\n// WEBPACK FOOTER //\n// ./src/data/mutations/update.js","module.exports = require(\"./assets.json\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"./assets.json\"\n// module id = 76\n// module chunks = 7","import { createStore, applyMiddleware, compose } from 'redux';\nimport createRootReducer from '../reducers';\nimport createLogger from './logger';\n\nexport default function configureStore(initialState) {\n  const middleware = [];\n\n  let enhancer;\n\n  if (__DEV__) {\n    middleware.push(createLogger());\n\n    // https://github.com/zalmoxisus/redux-devtools-extension#redux-devtools-extension\n    let devToolsExtension = f => f;\n    if (process.env.BROWSER && window.devToolsExtension) {\n      devToolsExtension = window.devToolsExtension();\n    }\n\n    enhancer = compose(applyMiddleware(...middleware), devToolsExtension);\n  } else {\n    enhancer = applyMiddleware(...middleware);\n  }\n\n  const rootReducer = createRootReducer();\n\n  // See https://github.com/rackt/redux/releases/tag/v3.1.0\n  const store = createStore(rootReducer, initialState, enhancer);\n\n  // Hot reload reducers (requires Webpack or Browserify HMR to be enabled)\n  if (__DEV__ && module.hot) {\n    module.hot.accept('../reducers', () =>\n      // eslint-disable-next-line global-require\n      store.replaceReducer(require('../reducers').default),\n    );\n  }\n\n  return store;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/store/configureStore.js","import { combineReducers } from 'redux';\nimport user from './user';\nimport runtime from './runtime';\n\nexport default function createRootReducer() {\n  return combineReducers({\n    user,\n    runtime,\n  });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/reducers/index.js","export default function user(state = {}, action) {\n  switch (action.type) {\n    default:\n      return state;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/reducers/user.js","import { SET_RUNTIME_VARIABLE } from '../constants';\n\nexport default function runtime(state = {}, action) {\n  switch (action.type) {\n    case SET_RUNTIME_VARIABLE:\n      return {\n        ...state,\n        [action.payload.name]: action.payload.value,\n      };\n    default:\n      return state;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/reducers/runtime.js","import { inspect } from 'util';\n\nfunction inspectObject(object) {\n  return inspect(object, {\n    colors: true,\n  });\n}\n\nfunction singleLine(str) {\n  return str.replace(/\\s+/g, ' ');\n}\n\nconst actionFormatters = {\n  // This is used at feature/apollo branch, but it can help you when implementing Apollo\n  APOLLO_QUERY_INIT: a =>\n    `queryId:${a.queryId} variables:${inspectObject(\n      a.variables,\n    )}\\n   ${singleLine(a.queryString)}`,\n\n  APOLLO_QUERY_RESULT: a =>\n    `queryId:${a.queryId}\\n   ${singleLine(inspectObject(a.result))}`,\n\n  APOLLO_QUERY_STOP: a => `queryId:${a.queryId}`,\n};\n\n// Server side redux action logger\nexport default function createLogger() {\n  // eslint-disable-next-line no-unused-vars\n  return store => next => action => {\n    let formattedPayload = '';\n    const actionFormatter = actionFormatters[action.type];\n    if (typeof actionFormatter === 'function') {\n      formattedPayload = actionFormatter(action);\n    } else if (action.toString !== Object.prototype.toString) {\n      formattedPayload = action.toString();\n    } else if (typeof action.payload !== 'undefined') {\n      formattedPayload = inspectObject(action.payload);\n    } else {\n      formattedPayload = inspectObject(action);\n    }\n\n    console.log(` * ${action.type}: ${formattedPayload}`); // eslint-disable-line no-console\n    return next(action);\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/store/logger/logger.server.js","module.exports = require(\"util\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"util\"\n// module id = 82\n// module chunks = 7","/* eslint-disable import/prefer-default-export */\n\nimport { SET_RUNTIME_VARIABLE } from '../constants';\n\nexport function setRuntimeVariable({ name, value }) {\n  return {\n    type: SET_RUNTIME_VARIABLE,\n    payload: {\n      name,\n      value,\n    },\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/actions/runtime.js","module.exports = require(\"classnames/bind\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"classnames/bind\"\n// module id = 84\n// module chunks = 7","module.exports = require(\"material-ui/SelectField\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"material-ui/SelectField\"\n// module id = 90\n// module chunks = 7","module.exports = require(\"material-ui/MenuItem\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"material-ui/MenuItem\"\n// module id = 91\n// module chunks = 7","module.exports = require(\"material-ui/RaisedButton\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"material-ui/RaisedButton\"\n// module id = 92\n// module chunks = 7","module.exports = require(\"sweetalert2\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"sweetalert2\"\n// module id = 93\n// module chunks = 7","module.exports = require(\"react-websocket\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-websocket\"\n// module id = 95\n// module chunks = 7","module.exports = require(\"react-rangeslider\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-rangeslider\"\n// module id = 96\n// module chunks = 7"],"sourceRoot":""}